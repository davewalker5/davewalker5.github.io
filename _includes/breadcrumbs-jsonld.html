{%- comment -%}
  Outputs JSON-LD BreadcrumbList based on page.url
{%- endcomment -%}

{%- assign origin = site.url | append: site.baseurl -%}

{%- if page.breadcrumb_items -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {%- for bc in page.breadcrumb_items -%}
    {
      "@type": "ListItem",
      "position": {{ forloop.index }},
      "name": {{ bc.name | jsonify }},
      "item": {{ origin | append: bc.url | replace: '//', '/' | prepend: site.url | jsonify }}
    }{%- unless forloop.last -%},{%- endunless -%}
    {%- endfor -%}
  ]
}
</script>
{%- else -%}
{%- assign parts = page.url | split: '/' -%}
{%- assign path = "" -%}
{%- assign items_json = "" -%}
{%- assign pos = 1 -%}

{%- capture items_json -%}
{
  "@type": "ListItem",
  "position": {{ pos }},
  "name": "Home",
  "item": {{ origin | append: "/" | jsonify }}
}
{%- endcapture -%}

{%- for part in parts -%}
  {%- if part != "" and part != "index.html" -%}
    {%- assign path = path | append: '/' | append: part -%}
    {%- assign pos = pos | plus: 1 -%}

    {%- assign raw_label = page.breadcrumb | default: part -%}
    {%- assign label = raw_label | replace:'.html','' | replace:'-',' ' | capitalize -%}

    {%- capture next_item -%}
,{
  "@type": "ListItem",
  "position": {{ pos }},
  "name": {{ label | jsonify }},
  "item": {{ origin | append: path | jsonify }}
}
    {%- endcapture -%}

    {%- assign items_json = items_json | append: next_item -%}
  {%- endif -%}
{%- endfor -%}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
{{ items_json }}
  ]
}
</script>
{%- endif -%}
